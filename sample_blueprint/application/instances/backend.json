{
  "kind": "application",
  "flavor": "default",
  "version": "latest",
  "disabled": false,
  "provided": true,
  "depends_on": [
    "redis.main"
  ],
  "metadata": {
    "name": "app1",
    "labels": {
      "sidecar.istio.io/inject": "true"
    },
    "annotations": {
      "traffic.sidecar.istio.io/excludeOutboundIPRanges": "*"
    }
  },
  "spec": {
    "release": {
      "strategy": "RollingUpdate",
      "build": {
        "artifactory": "default",
        "name": "alpha-stack-app1"
      }
    },
    "runtime": {
      "autoscaling": {
        "min": 1,
        "max": 2,
        "cpuThreshold": 50
      },
      "ports": {
        "grpc": "${template.application.out.ports.grpc}",
        "custom-metrics": 9110
      },
      "metrics": {
        "custom": {
          "portName": "custom-metrics",
          "path": "/"
        }
      },
      "size": "${template.application.out.sizing.GENERAL_PURPOSE.SMALL}"
    },
    "env": {
      "LOG_LEVEL": "INFO",
      "NEWRELIC_KEY": "${stack.out.variables.NEW_RELIC_KEY}",
      "REGION": "${stack.out.variables.REGION}",
      "REDIS_URL": "${redis.main.out.interfaces.default.host}",
      "REDIS_PORT": "${redis.main.out.interfaces.default.port}",
      "REDIS_USERNAME": "${redis.main.out.interfaces.default.username}",
      "REDIS_PASSWORD": "${redis.main.out.interfaces.default.password}",
      "S3_BUCKET": "${s3.log.out.bucket_name}"
    },
    "permission": {
      "s3_permission": {
        "resource": "s3.log",
        "access": "READ"
      }
    }
  },
  "out": {
    "comment": "Will be generated, or can be provided",
    "interface": {
      "grpc": {
        "port": 1000,
        "host": "app1.namespace",
        "username": "user",
        "password": "password"
      },
      "custom-metrics": {
        "port": 1000,
        "host": "app1.namespace",
        "username": "user",
        "password": "password"
      }
    }
  }
}