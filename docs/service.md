# Service

## Schema Properties

|                                                           | Type                                         | Description                                                                                                                                                                    | Required   |
|:----------------------------------------------------------|:---------------------------------------------|:-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:-----------|
| conditional_on_intent                                     | string                                       | Flag to enable the resource based on intent availability. eg mysql if mysql dashboard is required to be deployed. Note: Need to have the instance running beforehand to avail. | No         |
| depends_on                                                | array                                        | Dependencies on other resources. e.g. application x may depend on mysql                                                                                                        | No         |
| disabled                                                  | boolean                                      | Flag to disable the resource                                                                                                                                                   | No         |
| flavor                                                    | enum: default                                | Implementation selector for the resource. e.g. for a resource type ingress, default, aws_alb, gcp_alb etc.                                                                     | No         |
| kind                                                      | enum: service                                | Describes the type of resource. e.g. ingress, application, mysql etc. If not specified, fallback is the `folder_name`/instances                                                | No         |
| lifecycle                                                 | enum: ENVIRONMENT_BOOTSTRAP                  | This field describes the phase in which the resource has to be invoked (`ENVIRONMENT_BOOTSTRAP`)                                                                               | No         |
| provided                                                  | boolean                                      | Flag to tell if the resource should not be provisioned by facets                                                                                                               | No         |
| version                                                   | enum: 0.1                                    | This field can be used to pin to a particular version                                                                                                                          | No         |
| metadata.name                                             | string                                       | Name of the resource                                                                                                                                                           | No         |
|                                                           |                                              |     - if not specified, fallback is the `filename`                                                                                                                             |            |
| spec                                                      | object                                       | Specification as per resource types schema                                                                                                                                     | No         |
| spec.enable_host_anti_affinity                            | boolean                                      | boolean to enable or disable host anti affinity                                                                                                                                | Yes        |
| spec.env                                                  | object                                       | The key value pairs of all the environment variables that needs to be passed to the pod                                                                                        | No         |
| spec.release.build.artifactory                            | string                                       | Parent artifactory name                                                                                                                                                        | Yes        |
| spec.release.build.name                                   | string                                       | Name of the artifactory                                                                                                                                                        | Yes        |
| spec.release.disruption_policy.max_unavailable            | integer                                      | This is the max number of pods that can be unavailable during a failure.                                                                                                       | No         |
| spec.release.disruption_policy.min_available              | integer                                      | This is the min number of pods should be available in case of failures                                                                                                         | No         |
| spec.release.image                                        | string                                       | The docker image of the application that you want to run                                                                                                                       | No         |
| spec.release.strategy.max_available                       | integer                                      | If type RollingUpdate , this is the max number of pods that can be created from the default replicas                                                                           | No         |
| spec.release.strategy.max_unavailable                     | integer                                      | If type RollingUpdate , this is the max number of pods that can be unavailable from the default replicas                                                                       | No         |
| spec.release.strategy.type                                | enum: RollingUpdate, Recreate                | Your kubernetes rollout type eg: RollingUpdate or Recreate                                                                                                                     | No         |
| spec.restart_policy                                       | enum: Always, OnFailure, Never               | Can be of type Always , OnFailure or Never                                                                                                                                     | No         |
| spec.runtime.args                                         | array                                        | The list of arguments you want to pass for the above mentioned command                                                                                                         | No         |
| spec.runtime.autoscaling.cpu_threshold                    | integer                                      | The max cpu threshold that the hpa waits until it upscales                                                                                                                     | No         |
| spec.runtime.autoscaling.max                              | integer                                      | This is the max replicas where the hpa upscales to                                                                                                                             | No         |
| spec.runtime.autoscaling.min                              | integer                                      | This is the min replicas where the hpa downscales to                                                                                                                           | No         |
| spec.runtime.autoscaling.packets_per_second               | string                                       | The max number of packets that can be sent to the pod, once exceeded it autoscales. eg: 10k                                                                                    | No         |
| spec.runtime.autoscaling.ram_threshold                    | integer                                      | The max ram threshold that the hpa waits until it upscales                                                                                                                     | No         |
| spec.runtime.autoscaling.requests_per_second.ingress_name | string                                       | Name of the ingress object that the hpa should watch for autoscaling                                                                                                           | Yes        |
| spec.runtime.autoscaling.requests_per_second.threshold    | string                                       | The rps threshold that hpa looks for , once exceeds it autoscales eg: 10k                                                                                                      | Yes        |
| spec.runtime.command                                      | array                                        | The list of commands you want to perform before starting the container                                                                                                         | No         |
| spec.runtime.health_checks.liveness_exec_command          | array                                        | The list of commands to make liveness check                                                                                                                                    | No         |
| spec.runtime.health_checks.liveness_url                   | string                                       | URL to make the liveness check                                                                                                                                                 | No         |
| spec.runtime.health_checks.period                         | integer                                      | This is the repeated interval in which kubelet does a health check                                                                                                             | Yes        |
| spec.runtime.health_checks.port                           | integer                                      | Specify the port in which the health checks should be made                                                                                                                     | Yes        |
| spec.runtime.health_checks.readiness_exec_command         | array                                        | The list of commands to make readiness check                                                                                                                                   | No         |
| spec.runtime.health_checks.readiness_url                  | string                                       | URL to make the readiness check                                                                                                                                                | No         |
| spec.runtime.health_checks.start_up_time                  | integer                                      | The time kubernetes api needs to wait until the application is ready                                                                                                           | Yes        |
| spec.runtime.health_checks.timeout                        | integer                                      | Timeout for the health check                                                                                                                                                   | Yes        |
| spec.runtime.metrics.KEY.path                             | string                                       | the path where the service monitor should scrape metrics                                                                                                                       | Yes        |
| spec.runtime.metrics.KEY.port_name                        | string                                       | name of the service monitor                                                                                                                                                    | Yes        |
| spec.runtime.ports.KEY.port                               | string                                       | the port number where the pod is exposed                                                                                                                                       | Yes        |
| spec.runtime.ports.KEY.protocol                           | enum: tcp, udp                               | the protocol of the port , either tcp or udp                                                                                                                                   | Yes        |
| spec.runtime.ports.KEY.service_port                       | string                                       | the port number where the service is exposed, this is optional                                                                                                                 | No         |
| spec.runtime.size.cpu                                     | string                                       | The number of CPU cores required, e.g '1' or '1000m'                                                                                                                           | Yes        |
| spec.runtime.size.cpu_limit                               | string                                       | The CPU limit to set a maximum limit on the amount of CPU resources utilization, e.g '1' or '1000m'                                                                            | No         |
| spec.runtime.size.memory                                  | string                                       | The amount of memory required, e.g '800Mi' or '1.5Gi'                                                                                                                          | Yes        |
| spec.runtime.size.memory_limit                            | string                                       | The memory limit to set a maximum limit on the amount of memory resources utilization, e.g '800Mi' or '1.5Gi'                                                                  | No         |
| spec.runtime.volumes.config_maps.KEY.mount_path           | string                                       | The mount path for the config map                                                                                                                                              | No         |
| spec.runtime.volumes.config_maps.KEY.name                 | string                                       | The name of the config map that has been created in the kubernetes cluster                                                                                                     | No         |
| spec.type                                                 | enum: application, statefulset, cronjob, job | This will specify the type of service you want to create. eg: application, statefulset,cronjob etc                                                                             | Yes        |

## Outputs

|                                      | Type    | Description                                                                             | Required   | Referencing                                                   |
|:-------------------------------------|:--------|:----------------------------------------------------------------------------------------|:-----------|:--------------------------------------------------------------|
| out.interfaces.KEY.host              | string  | The hostname or IP address of the database or cache server.                             | Yes        | ${service.RESOURCE_NAME.out.interfaces.KEY.host}              |
| out.interfaces.KEY.port              | integer | The port number to use for connecting to the database or cache server.                  | Yes        | ${service.RESOURCE_NAME.out.interfaces.KEY.port}              |
| out.interfaces.KEY.username          | string  | The username to use for authentication when connecting to the database or cache server. | No         | ${service.RESOURCE_NAME.out.interfaces.KEY.username}          |
| out.interfaces.KEY.password          | string  | The password to use for authentication when connecting to the database or cache server. | No         | ${service.RESOURCE_NAME.out.interfaces.KEY.password}          |
| out.interfaces.KEY.connection_string | string  | The connection_string to use when connecting to the datastore.                          | Yes        | ${service.RESOURCE_NAME.out.interfaces.KEY.connection_string} |

